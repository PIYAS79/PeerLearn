// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String      @id @default(uuid())
  email      String      @unique
  password   String
  role       User_Role   @default(STUDENT)
  status     User_Status @default(ACTIVE)
  created_at DateTime    @default(now())
  updated_at DateTime    @updatedAt

  person Person?

  @@map("users")
}

model Person {
  id         String   @id @default(uuid())
  email      String   @unique
  first_name String
  last_name  String
  photo_url  String?
  is_active  Boolean  @default(true)
  bkash      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user                  User           @relation(fields: [email], references: [email])
  academicInfo          Academic_Info?
  expertises            Expertise[]
  as_req_maker          Request[]      @relation("RequestMaker")
  as_target_user        Request[]      @relation("TargetUser")
  as_review_maker       Review[]       @relation("ReviewMaker")
  as_review_target_user Review[]       @relation("ReviewTargetUser")

  @@map("persons")
}

model Academic_Info {
  id         String               @id @default(uuid())
  person_id  String               @unique
  person     Person               @relation(fields: [person_id], references: [id])
  student_id String
  university String
  department Academic_Deprartment
  level      Academic_Level
  term       Academic_Term
  created_at DateTime             @default(now())
  updated_at DateTime             @updatedAt

  @@map("academic_informations")
}

model Expertise {
  id           String           @id @default(uuid())
  person_id    String
  person       Person           @relation(fields: [person_id], references: [id])
  course_title Academic_Courses
  course_code  String
  topic        String
  level        Expertise_Level
  created_at   DateTime         @default(now())
  updated_at   DateTime         @updatedAt

  @@map("expertises")
}

model Request {
  id             String         @id @default(uuid())
  req_maker_id   String
  req_maker      Person         @relation("RequestMaker", fields: [req_maker_id], references: [id])
  target_user_id String?
  target_user    Person?        @relation("TargetUser", fields: [target_user_id], references: [id])
  title          String
  message        String
  status         Request_Status @default(PENDING)
  is_urgent      Boolean        @default(false)
  call_id        String?
  call_start_at  String?
  ai_rating      Int?
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt

  questionStacks Question_Stack[]

  @@map("requests")
}

model Question_Stack {
  id              String  @id @default(uuid())
  request_id      String
  request         Request @relation(fields: [request_id], references: [id])
  question        String
  question_number Int     @default(0)
  opt_a           String
  opt_b           String
  opt_c           String
  opt_d           String
  correct_ans     String

  @@map("question_stack")
}

model Review {
  id             String           @id @default(uuid())
  req_maker_id   String
  req_maker      Person           @relation("ReviewMaker", fields: [req_maker_id], references: [id])
  target_user_id String
  target_user    Person           @relation("ReviewTargetUser", fields: [target_user_id], references: [id])
  ai_rating      Int
  human_rating   Int
  title          String
  details        String
  course_title   Academic_Courses
  course_code    String?
  topic          String

  @@map("reviews")
}

enum Review_Status {
  PENDING
}

enum Request_Status {
  PENDING
  ACCEPTED
  ONGOING
  COMPLETED
  REJECTED
}

enum User_Status {
  ACTIVE
  BLOCK
}

enum User_Role {
  SUPERADMIN
  ADMIN
  STUDENT
  TEACHER
}

enum Academic_Level {
  L1
  L2
  L3
  L4
}

enum Academic_Term {
  T1
  T2
  T3
}

// after constant
enum Academic_Courses {
  OS
  DMML
  MAD
  AI
  WEB_ENGINEERING
}

// after constant
enum Academic_Deprartment {
  CSE
  CIS
  SWE
  EEE
  MCT
  ESDM
  PHRM
  TEX
}

enum Expertise_Level {
  EXPERT
  BEGINNER
}
